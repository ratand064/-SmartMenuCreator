<ion-header class="ion-no-border">
  <ion-toolbar class="custom-toolbar">
    <ion-title class="main-title">
      Create <span>Item</span>
    </ion-title>
  </ion-toolbar>
</ion-header>
<ion-content class="ion-padding">
  <div class="input-section">
    <p class="hint-text">Describe your dish to AI...</p>
    <ion-textarea 
      class="custom-textarea" 
      [(ngModel)]="inputText" 
      placeholder="e.g. 'Spicy Chicken Biryani plate for 250'" 
      rows="4" 
      autoGrow="true">
    </ion-textarea>
    <ion-grid class="ion-no-padding">
      <ion-row>
        <ion-col size="3" class="mic-col">
          <ion-button 
            expand="block" 
            fill="outline" 
            class="mic-btn" 
            [class.mic-active]="isListening" 
            (click)="startListening()">
            <ion-icon [name]="isListening ? 'mic' : 'mic-outline'"></ion-icon>
          </ion-button>
        </ion-col>
        <ion-col size="9">
          <ion-button 
            expand="block" 
            color="primary" 
            class="process-btn" 
            (click)="processAI()" 
            [disabled]="loading || !inputText">
            <ion-spinner *ngIf="loading" name="dots"></ion-spinner>
            <span *ngIf="!loading" class="btn-content">
              Generate <ion-icon name="sparkles"></ion-icon>
            </span>
          </ion-button>
        </ion-col>
      </ion-row>
      <ion-row *ngIf="isListening">
        <ion-col class="ion-text-center">
          <p class="recording-text fade-in">Listening... Speak now üéôÔ∏è</p>
        </ion-col>
      </ion-row>
    </ion-grid>
  </div>
  <div *ngIf="parsedItem" class="fade-in result-card">
    <div class="ion-padding-horizontal ion-padding-top">
      <ion-item lines="none" class="form-input-item title-input">
        <ion-label position="stacked">TITLE</ion-label>
        <ion-input [(ngModel)]="parsedItem.title"></ion-input>
      </ion-item>
    </div>
    <div class="ion-padding-horizontal">
      <ion-item lines="none" class="form-input-item">
        <ion-label position="stacked">DESCRIPTION</ion-label>
        <ion-textarea [(ngModel)]="parsedItem.description" rows="3" autoGrow="true"></ion-textarea>
      </ion-item>
    </div>
    <div class="ion-padding-horizontal">
      <ion-item lines="none" class="form-input-item price-input">
        <ion-label position="stacked">PRICE (‚Çπ)</ion-label>
        <ion-input type="number" [(ngModel)]="parsedItem.price"></ion-input>
      </ion-item>
    </div>
    <div class="image-section-wrapper">
      <div class="hero-image-container" *ngIf="parsedItem.imageUrl || imageLoading">
        <div *ngIf="imageLoading" class="image-loader">
          <ion-spinner name="crescent" color="primary"></ion-spinner>
          <p>AI is painting... üé®</p>
        </div>
        <img 
          *ngIf="!imageLoading && parsedItem.imageUrl" 
          [src]="parsedItem.imageUrl" 
          (error)="handleImageError($event)" 
          alt="Dish Image">
      </div>
      <ion-grid class="ion-no-padding options-grid">
        <ion-row>
          <ion-col size="6" class="separator-col">
            <ion-button 
              expand="full" 
              fill="clear" 
              class="option-btn" 
              (click)="generateImage()" 
              [disabled]="imageLoading">
              <span class="btn-content">
                <ion-icon name="sparkles" slot="start" [color]="imageLoading ? 'medium' : 'primary'"></ion-icon> 
                {{ imageLoading ? 'Generating...' : 'AI Image' }}
              </span>
            </ion-button>
          </ion-col>
          <ion-col size="6">
            <ion-button 
              expand="full" 
              fill="clear" 
              class="option-btn" 
              (click)="fileInput.click()"
              [disabled]="imageLoading">
              <span class="btn-content">
                <ion-icon name="camera" slot="start"></ion-icon> 
                Upload
              </span>
            </ion-button>
          </ion-col>
        </ion-row>
      </ion-grid>
    </div>
    <div class="ion-padding">
      <ion-button 
        expand="block" 
        color="success" 
        class="save-btn" 
        (click)="saveItem()" 
        [disabled]="loading || imageLoading">
        <ion-spinner *ngIf="loading" name="dots"></ion-spinner>
        <span *ngIf="!loading">
          Save to Menu <ion-icon name="checkmark-circle" slot="end"></ion-icon>
        </span>
      </ion-button>
    </div>
    <input #fileInput type="file" accept="image/*" (change)="onFileSelected($event)" hidden>
  </div>
</ion-content>